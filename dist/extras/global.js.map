{"version":3,"file":"global.js","sources":["../../src/extras/global.js"],"sourcesContent":["/*\n * SystemJS global script loading support\n * Extra for the s.js build only\n * (Included by default in system.js build)\n */\n\nconst systemJSPrototype = System.constructor.prototype;\n\n// safari unpredictably lists some new globals first or second in object order\nlet firstGlobalProp, secondGlobalProp, lastGlobalProp;\nfunction getGlobalProp () {\n  let cnt = 0;\n  let lastProp;\n  for (let p in global) {\n    if (!global.hasOwnProperty(p))\n      continue;\n    if (cnt === 0 && p !== firstGlobalProp || cnt === 1 && p !== secondGlobalProp)\n      return p;\n    cnt++;\n    lastProp = p;\n  }\n  if (lastProp !== lastGlobalProp)\n    return lastProp;\n}\n\nfunction noteGlobalProps () {\n  // alternatively Object.keys(global).pop()\n  // but this may be faster (pending benchmarks)\n  firstGlobalProp = secondGlobalProp = undefined;\n  for (let p in global) {\n    if (!global.hasOwnProperty(p))\n      continue;\n    if (!firstGlobalProp)\n      firstGlobalProp = p;\n    else if (!secondGlobalProp)\n      secondGlobalProp = p;\n    lastGlobalProp = p;\n  }\n  return lastGlobalProp;\n}\n\nconst impt = systemJSPrototype.import;\nsystemJSPrototype.import = function (id, parentUrl) {\n  noteGlobalProps();\n  return impt.call(this, id, parentUrl);\n};\n\nconst emptyInstantiation = [[], function () { return {} }];\n\nconst getRegister = systemJSPrototype.getRegister;\nsystemJSPrototype.getRegister = function () {\n  const lastRegister = getRegister.call(this);\n  if (lastRegister)\n    return lastRegister;\n\n  // no registration -> attempt a global detection as difference from snapshot\n  // when multiple globals, we take the global value to be the last defined new global object property\n  // for performance, this will not support multi-version / global collisions as previous SystemJS versions did\n  // note in Edge, deleting and re-adding a global does not change its ordering\n  const globalProp = getGlobalProp();\n  if (!globalProp)\n    return emptyInstantiation;\n\n  let globalExport;\n  try {\n    globalExport = global[globalProp];\n  }\n  catch (e) {\n    return emptyInstantiation;\n  }\n\n  return [[], function (_export) {\n    return { execute: function () { _export('default', globalExport) } };\n  }];\n};\n"],"names":["systemJSPrototype","System","constructor","prototype","firstGlobalProp","secondGlobalProp","lastGlobalProp","getGlobalProp","cnt","lastProp","p","global","hasOwnProperty","noteGlobalProps","undefined","impt","import","id","parentUrl","call","emptyInstantiation","getRegister","lastRegister","globalProp","globalExport","e","_export","execute"],"mappings":";;;;;;CAAA;;;;;CAMA,MAAMA,iBAAiB,GAAGC,MAAM,CAACC,WAAP,CAAmBC,SAA7C;;CAGA,IAAIC,eAAJ,EAAqBC,gBAArB,EAAuCC,cAAvC;;CACA,SAASC,aAAT,GAA0B;OACpBC,GAAG,GAAG,CAAV;OACIC,QAAJ;;QACK,IAAIC,CAAT,IAAcC,cAAd,EAAsB;SAChB,CAACA,cAAM,CAACC,cAAP,CAAsBF,CAAtB,CAAL,EACE;SACEF,GAAG,KAAK,CAAR,IAAaE,CAAC,KAAKN,eAAnB,IAAsCI,GAAG,KAAK,CAAR,IAAaE,CAAC,KAAKL,gBAA7D,EACE,OAAOK,CAAP;KACFF,GAAG;KACHC,QAAQ,GAAGC,CAAX;;;OAEED,QAAQ,KAAKH,cAAjB,EACE,OAAOG,QAAP;;;CAGJ,SAASI,eAAT,GAA4B;;;GAG1BT,eAAe,GAAGC,gBAAgB,GAAGS,SAArC;;QACK,IAAIJ,CAAT,IAAcC,cAAd,EAAsB;SAChB,CAACA,cAAM,CAACC,cAAP,CAAsBF,CAAtB,CAAL,EACE;SACE,CAACN,eAAL,EACEA,eAAe,GAAGM,CAAlB,CADF,KAEK,IAAI,CAACL,gBAAL,EACHA,gBAAgB,GAAGK,CAAnB;KACFJ,cAAc,GAAGI,CAAjB;;;UAEKJ,cAAP;;;CAGF,MAAMS,IAAI,GAAGf,iBAAiB,CAACgB,MAA/B;;CACAhB,iBAAiB,CAACgB,MAAlB,GAA2B,UAAUC,EAAV,EAAcC,SAAd,EAAyB;GAClDL,eAAe;UACRE,IAAI,CAACI,IAAL,CAAU,IAAV,EAAgBF,EAAhB,EAAoBC,SAApB,CAAP;EAFF;;CAKA,MAAME,kBAAkB,GAAG,CAAC,EAAD,EAAK,YAAY;UAAS,EAAP;EAAnB,CAA3B;CAEA,MAAMC,WAAW,GAAGrB,iBAAiB,CAACqB,WAAtC;;CACArB,iBAAiB,CAACqB,WAAlB,GAAgC,YAAY;SACpCC,YAAY,GAAGD,WAAW,CAACF,IAAZ,CAAiB,IAAjB,CAArB;OACIG,YAAJ,EACE,OAAOA,YAAP,CAHwC;;;;;SASpCC,UAAU,GAAGhB,aAAa,EAAhC;OACI,CAACgB,UAAL,EACE,OAAOH,kBAAP;OAEEI,YAAJ;;OACI;KACFA,YAAY,GAAGb,cAAM,CAACY,UAAD,CAArB;IADF,CAGA,OAAOE,CAAP,EAAU;YACDL,kBAAP;;;UAGK,CAAC,EAAD,EAAK,UAAUM,OAAV,EAAmB;YACtB;OAAEC,OAAO,EAAE,YAAY;SAAED,OAAO,CAAC,SAAD,EAAYF,YAAZ,CAAP;;MAAhC;IADK,CAAP;EArBF;;;;;;;;;;;;"}