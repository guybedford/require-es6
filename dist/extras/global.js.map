{"version":3,"file":"global.js","sources":["../../src/extras/global.js"],"sourcesContent":["/*\n * SystemJS global script loading support\n * Extra for the s.js build only\n * (Included by default in system.js build)\n */\n\nconst systemJSPrototype = System.constructor.prototype;\n\n// safari unpredictably lists some new globals first or second in object order\nlet firstGlobalProp, secondGlobalProp, lastGlobalProp;\nfunction getGlobalProp () {\n  let cnt = 0;\n  let lastProp;\n  for (let p in global) {\n    if (!global.hasOwnProperty(p))\n      continue;\n    if (cnt === 0 && p !== firstGlobalProp || cnt === 1 && p !== secondGlobalProp)\n      return p;\n    cnt++;\n    lastProp = p;\n  }\n  if (lastProp !== lastGlobalProp)\n    return lastProp;\n}\n\nfunction noteGlobalProps () {\n  // alternatively Object.keys(global).pop()\n  // but this may be faster (pending benchmarks)\n  firstGlobalProp = secondGlobalProp = undefined;\n  for (let p in global) {\n    if (!global.hasOwnProperty(p))\n      continue;\n    if (!firstGlobalProp)\n      firstGlobalProp = p;\n    else if (!secondGlobalProp)\n      secondGlobalProp = p;\n    lastGlobalProp = p;\n  }\n  return lastGlobalProp;\n}\n\nconst impt = systemJSPrototype.import;\nsystemJSPrototype.import = function (id, parentUrl) {\n  noteGlobalProps();\n  return impt.call(this, id, parentUrl);\n};\n\nconst emptyInstantiation = [[], function () { return {} }];\n\nconst getRegister = systemJSPrototype.getRegister;\nsystemJSPrototype.getRegister = function () {\n  const lastRegister = getRegister.call(this);\n  if (lastRegister)\n    return lastRegister;\n\n  // no registration -> attempt a global detection as difference from snapshot\n  // when multiple globals, we take the global value to be the last defined new global object property\n  // for performance, this will not support multi-version / global collisions as previous SystemJS versions did\n  // note in Edge, deleting and re-adding a global does not change its ordering\n  const globalProp = getGlobalProp();\n  if (!globalProp)\n    return emptyInstantiation;\n\n  let globalExport;\n  try {\n    globalExport = global[globalProp];\n  }\n  catch (e) {\n    return emptyInstantiation;\n  }\n\n  return [[], function (_export) {\n    return { execute: function () { _export('default', globalExport) } };\n  }];\n};\n"],"names":["global"],"mappings":";;;;;CAAA;;;;;;CAMA,MAAM,iBAAiB,GAAG,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC;;;CAGvD,IAAI,eAAe,EAAE,gBAAgB,EAAE,cAAc,CAAC;CACtD,SAAS,aAAa,IAAI;GACxB,IAAI,GAAG,GAAG,CAAC,CAAC;GACZ,IAAI,QAAQ,CAAC;GACb,KAAK,IAAI,CAAC,IAAIA,cAAM,EAAE;KACpB,IAAI,CAACA,cAAM,CAAC,cAAc,CAAC,CAAC,CAAC;OAC3B,SAAS;KACX,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,eAAe,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,gBAAgB;OAC3E,OAAO,CAAC,CAAC;KACX,GAAG,EAAE,CAAC;KACN,QAAQ,GAAG,CAAC,CAAC;IACd;GACD,IAAI,QAAQ,KAAK,cAAc;KAC7B,OAAO,QAAQ,CAAC;EACnB;;CAED,SAAS,eAAe,IAAI;;;GAG1B,eAAe,GAAG,gBAAgB,GAAG,SAAS,CAAC;GAC/C,KAAK,IAAI,CAAC,IAAIA,cAAM,EAAE;KACpB,IAAI,CAACA,cAAM,CAAC,cAAc,CAAC,CAAC,CAAC;OAC3B,SAAS;KACX,IAAI,CAAC,eAAe;OAClB,eAAe,GAAG,CAAC,CAAC;UACjB,IAAI,CAAC,gBAAgB;OACxB,gBAAgB,GAAG,CAAC,CAAC;KACvB,cAAc,GAAG,CAAC,CAAC;IACpB;GACD,OAAO,cAAc,CAAC;EACvB;;CAED,MAAM,IAAI,GAAG,iBAAiB,CAAC,MAAM,CAAC;CACtC,iBAAiB,CAAC,MAAM,GAAG,UAAU,EAAE,EAAE,SAAS,EAAE;GAClD,eAAe,EAAE,CAAC;GAClB,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC;EACvC,CAAC;;CAEF,MAAM,kBAAkB,GAAG,CAAC,EAAE,EAAE,YAAY,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;;CAE3D,MAAM,WAAW,GAAG,iBAAiB,CAAC,WAAW,CAAC;CAClD,iBAAiB,CAAC,WAAW,GAAG,YAAY;GAC1C,MAAM,YAAY,GAAG,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;GAC5C,IAAI,YAAY;KACd,OAAO,YAAY,CAAC;;;;;;GAMtB,MAAM,UAAU,GAAG,aAAa,EAAE,CAAC;GACnC,IAAI,CAAC,UAAU;KACb,OAAO,kBAAkB,CAAC;;GAE5B,IAAI,YAAY,CAAC;GACjB,IAAI;KACF,YAAY,GAAGA,cAAM,CAAC,UAAU,CAAC,CAAC;IACnC;GACD,OAAO,CAAC,EAAE;KACR,OAAO,kBAAkB,CAAC;IAC3B;;GAED,OAAO,CAAC,EAAE,EAAE,UAAU,OAAO,EAAE;KAC7B,OAAO,EAAE,OAAO,EAAE,YAAY,EAAE,OAAO,CAAC,SAAS,EAAE,YAAY,EAAC,EAAE,EAAE,CAAC;IACtE,CAAC,CAAC;EACJ,CAAC;;;;;;;;;;;;"}